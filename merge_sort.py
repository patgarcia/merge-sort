def _sort(a, b):
    result = []

    # handle None cases
    a = [] if not a else a
    b = [] if not b else b
    if not a or not b:
        return a + b

    # optimization
    if a[0] >= b[-1]:
        return b + a
    if a[-1] <= b[0]:
        return a + b

    i = j = None
    while a or b:
        if not i:
            i = a.pop(0)
        if not j:
            j = b.pop(0)

        if i < j:
            result.append(i)
            if not a:
                result += [j] + b
                break
            i = None
        else:
            result.append(j)
            if not b:
                result += [i] + a
                break
            j = None

    return result


def merge_sort(l):
    if len(l) == 1:
        return l
    mid = len(l) // 2
    return _sort(merge_sort(l[:mid]), merge_sort(l[mid:]))


# TEST
if __name__ == "__main__":

    test_list = [
        -949,
        744,
        128,
        538,
        -538,
        -128,
        282,
        -744,
        -179,
        333,
        -692,
        -1000,
        487,
        385,
        897,
        -897,
        -692,
        590,
        -846,
        538,
        590,
        282,
        385,
        -641,
        179,
        -179,
        897,
        795,
        -231,
        795,
        949,
        949,
        -949,
        846,
        231,
        333,
        -128,
        -179,
        -436,
        -333,
        641,
        -744,
        -641,
        -436,
        -231,
        -487,
        -795,
        77,
        -846,
        -1000,
        -487,
        179,
        949,
        744,
        641,
        487,
        -333,
        128,
        -795,
        -590,
        -282,
        -385,
        -590,
        641,
        949,
        -333,
        436,
        -641,
        -949,
        -487,
        -590,
        -692,
        -436,
        -538,
        -385,
        282,
        -385,
        692,
        26,
        -846,
        436,
        897,
        385,
        26,
        590,
        333,
        -128,
        -282,
        77,
        -282,
        231,
        1000,
        -77,
        -26,
        1000,
        692,
        538,
    ]

    print(merge_sort(test_list))

# OUTPUT
# -1000, -1000, -949, -949, -949, -897, -846, -846, -846, -795, -795,
# -744, -744, -692, -692, -692, -641, -641, -641, -590, -590, -590, -538, -538,
# -487, -487, -487, -436, -436, -436, -385, -385, -385, -333, -333, -333, -282,
# -282, -282, -231, -231, -179, -179, -179, -128, -128, -128, -77, -26, 26, 26,
# 77, 77, 128, 128, 179, 179, 231, 231, 282, 282, 282, 333, 333, 333, 385, 385,
# 385, 436, 436, 487, 487, 538, 538, 538, 590, 590, 590, 641, 641, 641, 692, 692,
# 744, 744, 795, 795, 846, 897, 897, 897, 949, 949, 949, 949, 1000, 1000
